{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://luhtech.dev/schemas/pm/authority-level.schema.json",
  "title": "Authority Level Schema",
  "description": "Defines the 7-tier authority cascade for construction project decisions. Each level has specific budget limits, variance tolerances, and schedule authority.",
  "type": "object",
  "required": ["$id", "$schema", "schemaVersion", "levels"],
  "definitions": {
    "_metadata": {
      "type": "object",
      "description": "Schema metadata - not for validation",
      "properties": {
        "version": { "const": "3.0.0" },
        "lastUpdated": { "const": "2026-01-06" },
        "maintainer": { "const": "LuhTech Enterprise Infrastructure" },
        "relatedSchemas": {
          "const": [
            "decision.schema.json",
            "participant.schema.json"
          ]
        }
      }
    },
    "urn": {
      "type": "string",
      "description": "LuhTech URN identifier",
      "pattern": "^urn:luhtech:[a-z][a-z0-9-]*:[a-z][a-z0-9-]*:[a-zA-Z0-9][a-zA-Z0-9-]*$"
    },
    "graphMetadata": {
      "type": "object",
      "description": "Bidirectional graph traversal metadata",
      "properties": {
        "inEdges": {
          "type": "array",
          "items": { "$ref": "#/definitions/urn" },
          "uniqueItems": true
        },
        "outEdges": {
          "type": "array",
          "items": { "$ref": "#/definitions/urn" },
          "uniqueItems": true
        }
      }
    },
    "authorityLevelName": {
      "type": "string",
      "enum": ["FIELD", "FOREMAN", "SUPERINTENDENT", "PM", "ARCHITECT", "OWNER", "REGULATORY"]
    },
    "levelDefinition": {
      "type": "object",
      "required": ["level", "name", "title"],
      "properties": {
        "$id": {
          "$ref": "#/definitions/urn",
          "description": "URN for this specific authority level"
        },
        "level": {
          "type": "integer",
          "minimum": 0,
          "maximum": 6,
          "description": "Numeric level (0-6)"
        },
        "name": {
          "$ref": "#/definitions/authorityLevelName",
          "description": "Authority level name"
        },
        "title": {
          "type": "string",
          "description": "Human-readable title"
        },
        "description": {
          "type": "string",
          "description": "Description of this authority level's responsibilities"
        },
        "budgetLimit": {
          "oneOf": [
            { "type": "number", "minimum": 0 },
            { "type": "string", "enum": ["design", "project", "code", "unlimited"] }
          ],
          "description": "Maximum budget authority in USD or special keyword"
        },
        "varianceTolerance": {
          "type": "string",
          "description": "Dimensional variance tolerance (e.g., '1/8\"', 'visible', 'safety')"
        },
        "scheduleAuthority": {
          "type": "string",
          "description": "Schedule change authority (e.g., '4 hours', '1 week', 'any')"
        },
        "autoApprove": {
          "type": "boolean",
          "default": false,
          "description": "Whether decisions at this level auto-approve"
        },
        "escalatesTo": {
          "type": "integer",
          "minimum": 0,
          "maximum": 6,
          "description": "Level to escalate to when authority exceeded"
        },
        "permissions": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "capture-decision",
              "approve-decision",
              "reject-decision",
              "escalate-decision",
              "modify-schedule",
              "authorize-payment",
              "close-project",
              "issue-stop-work",
              "override-design",
              "approve-substitution"
            ]
          },
          "description": "Permissions granted at this level"
        },
        "graphMetadata": {
          "$ref": "#/definitions/graphMetadata"
        }
      }
    }
  },
  "properties": {
    "$id": {
      "$ref": "#/definitions/urn",
      "description": "URN identifier. Pattern: urn:luhtech:{venture}:authority-level:cascade"
    },
    "$schema": {
      "const": "https://luhtech.dev/schemas/pm/authority-level.schema.json"
    },
    "schemaVersion": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "meta": {
      "type": "object",
      "properties": {
        "ventureId": { "type": "string" },
        "sourceOfTruth": { "type": "string" },
        "lastUpdated": { "type": "string", "format": "date-time" },
        "description": { "type": "string" }
      }
    },
    "levels": {
      "type": "array",
      "minItems": 7,
      "maxItems": 7,
      "items": { "$ref": "#/definitions/levelDefinition" },
      "description": "The 7-tier authority cascade (levels 0-6)"
    },
    "defaultCurrency": {
      "type": "string",
      "default": "USD",
      "description": "Default currency for budget limits"
    },
    "escalationRules": {
      "type": "object",
      "description": "Rules for automatic escalation",
      "properties": {
        "budgetExceedance": {
          "type": "boolean",
          "default": true,
          "description": "Auto-escalate when budget limit exceeded"
        },
        "scheduleExceedance": {
          "type": "boolean",
          "default": true,
          "description": "Auto-escalate when schedule authority exceeded"
        },
        "varianceExceedance": {
          "type": "boolean",
          "default": true,
          "description": "Auto-escalate when variance tolerance exceeded"
        },
        "safetyIssue": {
          "type": "boolean",
          "default": true,
          "description": "Auto-escalate to regulatory on safety issues"
        },
        "escalationTimeout": {
          "type": "integer",
          "default": 24,
          "description": "Hours before auto-escalation on no response"
        }
      }
    },
    "graphMetadata": {
      "$ref": "#/definitions/graphMetadata"
    }
  },
  "additionalProperties": false
}
